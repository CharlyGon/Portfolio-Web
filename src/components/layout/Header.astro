---
const navItems = [
    { title: "Home", label: "home", url: "/#home" },
    { title: "Experience", label: "experience", url: "/#experience" },
    { title: "Projects", label: "projects", url: "/#projects" },
    { title: "About Me", label: "aboutMe", url: "/#aboutMe" },
    { title: "Contact", label: "contact", url: "/#contact" },
    { title: "Newsletter", label: "newsletter", url: "/#newsletter" },
];
---

<header id="site-header" class="sticky top-0 z-50 w-full">
    <nav
        aria-label="Principal"
        class="mx-auto max-w-6xl px-4 h-16 flex items-center justify-center pointer-events-none"
    >
        <div
            id="header-nav"
            class="pointer-events-auto relative inline-flex items-center justify-center gap-1 whitespace-nowrap
             rounded-full px-3 sm:px-4 py-1.5 border border-white/10
             bg-black/25 backdrop-blur-md shadow-sm transition-all duration-300"
        >
            {
                navItems.map((link) => (
                    <a
                        class="hover:bg-white/10 px-4 py-2 rounded-full transition text-sm capitalize"
                        aria-label={link.label}
                        href={link.url}
                    >
                        {link.title}
                    </a>
                ))
            }
        </div>
    </nav>

    <script>
        document.addEventListener("astro:page-load", () => {
            const header = document.querySelector("header");
            const sections = document.querySelectorAll("section[id]");
            const navLinks = document.querySelectorAll(
                "header nav a[aria-label]",
            );

            if (!header) return;

            // Estado de scroll: sólo cambia la pastilla, no el <nav>
            const onScroll = () => {
                if (window.scrollY > 8) {
                    header.setAttribute("data-scrolled", "1");
                } else {
                    header.removeAttribute("data-scrolled");
                }
            };
            onScroll();
            window.addEventListener("scroll", onScroll, { passive: true });

            // Active link por intersección
            const io = new IntersectionObserver(
                (entries) => {
                    entries.forEach((e) => {
                        if (!e.isIntersecting) return;
                        navLinks.forEach((a) => {
                            a.classList.toggle(
                                "link-active",
                                a.getAttribute("aria-label") === e.target.id,
                            );
                        });
                    });
                },
                { threshold: 0.3 },
            );
            sections.forEach((s) => io.observe(s));
            document.addEventListener("visibilitychange", () => {
                if (document.visibilityState === "hidden") io.disconnect();
            });
        });
    </script>

    <style>
        /* estilo del link activo (sutil, profesional) */
        .link-active {
            @apply bg-white/10 text-white;
        }

        /* al hacer scroll, sólo intensificamos la pastilla */
        header[data-scrolled] #header-nav {
            @apply bg-black/40 backdrop-blur-2xl ring-1 ring-white/10 shadow-lg border-white/20;
        }

        /* opcional: que los anchors no queden ocultos bajo el sticky */
        :root {
            scroll-padding-top: theme(spacing.16);
        }
        html {
            scroll-behavior: smooth;
        }
    </style>
</header>
