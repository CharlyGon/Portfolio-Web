---
import Badge from "@/components/ui/Badge.astro";
import SocialPill from "@/components/ui/SocialPill.astro";
import LinkedInIcon from "@/components/icons/LinkedIn.astro";
import GitHubIcon from "@/components/icons/GitHub.astro";
import MailIcon from "@/components/icons/Mail.astro";
import HackerRank from "@/components/icons/HackerRank.astro";
import SectionContainer from "@/components/sections/SectionConteiner.astro";
import Scripts from "@/components/Scripts.astro";
import NodeJsIcon from "../icons/NodeJsIcon.astro";
import Aws from "../icons/Aws.astro";
import Typescript from "../icons/Typescript.astro";
import Docker from "../icons/Docker.astro";
---

<SectionContainer id="home" class="py-20 md:py-28">
    <!-- 1) alineamos arriba -->
    <div class="grid items-start gap-10 md:grid-cols-[1.2fr_.8fr]">
        <!-- Columna texto -->
        <div>
            <div
                class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs tracking-wide uppercase opacity-90 mb-4"
            >
                Backend • Node.js • TypeScript
            </div>

            <h1 class="text-3xl md:text-5xl font-bold leading-tight">
                Construyo backend <span class="text-yellow-300/90"
                    >escalable y medible</span
                > con Node.js & TypeScript.
            </h1>

            <p class="mt-8 text-neutral-300 max-w-prose">
                +3 años creando APIs y microservicios en equipos ágiles. Enfoque
                en buenas prácticas, automatización y performance en producción.
            </p>
        </div>

        <!-- Columna imagen -->
        <div class="justify-self-center self-start">
            <img
                src="/images/gonzalo.webp"
                alt="Foto de Gonzalo Fernández"
                class="object-cover w-56 md:w-64 lg:w-72 aspect-square rounded-2xl ring-1 ring-white/20 bg-white/5 mb-2 image-bounce"
                style="object-position: 50% 50%"
                loading="eager"
                decoding="async"
            />
            <p class="text-xs text-neutral-400 text-center">
                San Cayetano, Argentina
            </p>

            <!-- CTAs -->
            <div class="mt-7 flex flex-wrap gap-3">
                <a
                    href="#contact"
                    class="rounded-xl px-4 py-2 bg-white/10 hover:bg-white/15 transition"
                    >Hablemos</a
                >

                <a href="/Gonzalo_Fernandez_CV.pdf" download>
                    <Badge>Download CV</Badge>
                </a>

                <a
                    href="#projects"
                    class="rounded-xl px-4 py-2 ring-1 ring-white/10 hover:bg-white/5 transition"
                    >Ver proyectos →</a
                >
            </div>
        </div>

        <!-- HIGHLIGHTS-->
        <ul
            class="mt-8 grid gap-6 sm:grid-cols-2 col-span-full max-w-2xl mx-auto"
        >
            <li class="flex items-start gap-3">
                <NodeJsIcon class="size-10 md:size-12" />
                <span
                    >APIs y microservicios escalables en <strong>Node.js</strong
                    >.</span
                >
            </li>
            <li class="flex items-start gap-3">
                <Typescript class="size-10 md:size-12" />
                <span
                    >Tipado seguro y mantenible con <strong>TypeScript</strong
                    >.</span
                >
            </li>
            <li class="flex items-start gap-3">
                <Aws class="size-10 md:size-12" />
                <span
                    >Automatizaciones en la nube usando <strong
                        >AWS Lambda</strong
                    >.</span
                >
            </li>
            <li class="flex items-start gap-3">
                <Docker class="size-10 md:size-12" />
                <span
                    >Entornos reproducibles y CI/CD con <strong>Docker</strong
                    >.</span
                >
            </li>
        </ul>

        <!-- Social -->
        <nav
            class="mt-8 col-span-full mx-auto max-w-3xl md:max-w-4xl grid grid-flow-col auto-cols-max gap-3 justify-center"
        >
            <SocialPill
                href="https://www.linkedin.com/in/gonzalo-nicolas-fernandez"
                aria-label="LinkedIn"
            >
                <LinkedInIcon class="size-5 md:size-6" aria-hidden="true" /> LinkedIn
            </SocialPill>

            <SocialPill href="https://github.com/CharlyGon" aria-label="GitHub">
                <GitHubIcon class="size-5 md:size-6" aria-hidden="true" /> GitHub
            </SocialPill>

            <SocialPill
                href="https://www.hackerrank.com/profile/GonzaloFernandez"
                aria-label="HackerRank"
            >
                <HackerRank class="size-5 md:size-6" aria-hidden="true" /> HackerRank
            </SocialPill>

            <SocialPill
                id="emailLink"
                href="#"
                role="button"
                aria-label="Copiar email"
                data-email="fernandez-gonza@hotmail.com"
                class="relative overflow-visible select-none"
            >
                <MailIcon class="size-5 md:size-6" aria-hidden="true" />
                <span class="pill-label normal"
                    >fernandez-gonza@hotmail.com</span
                >
                <span class="pill-label copied hidden font-semibold"
                    >¡Copiado!</span
                >
            </SocialPill>
        </nav>
    </div>
</SectionContainer>

<script is:inline>
    document.addEventListener("astro:page-load", () => {
        const pill = document.getElementById("emailLink");
        if (!pill) return;

        const email = pill.getAttribute("data-email") || "";
        const normal = pill.querySelector(".pill-label.normal");
        const copied = pill.querySelector(".pill-label.copied");

        const showCopied = () => {
            pill.classList.add("is-copied");
            normal?.classList.add("hidden");
            copied?.classList.remove("hidden");

            if (
                !window.matchMedia("(prefers-reduced-motion: reduce)").matches
            ) {
                // confetti de colores + letras del email
                burstConfetti(pill, 18);
                burstLetters(pill, email, 14);
            }

            setTimeout(() => {
                pill.classList.remove("is-copied");
                copied?.classList.add("hidden");
                normal?.classList.remove("hidden");
            }, 1200);
        };

        // copiar al portapapeles
        const handleClick = async (ev) => {
            ev.preventDefault();
            try {
                await navigator.clipboard.writeText(email);
                showCopied();
            } catch {
                // fallback
                const ta = document.createElement("textarea");
                ta.value = email;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand("copy");
                ta.remove();
                showCopied();
            }
        };

        pill.addEventListener("click", handleClick);
        // accesible con teclado
        pill.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                handleClick(e);
            }
        });

        function burstConfetti(anchor, count = 16) {
            const rect = anchor.getBoundingClientRect();
            const cx = rect.left + rect.width / 2;
            const cy = rect.top + rect.height / 2;

            for (let i = 0; i < count; i++) {
                const s = document.createElement("span");
                s.className = "confetti";
                const size = 5 + Math.random() * 6;
                const hue = Math.floor(200 + Math.random() * 160);
                s.style.width = `${size}px`;
                s.style.height = `${size}px`;
                s.style.background = `hsl(${hue} 80% 60%)`;
                s.style.left = `${cx}px`;
                s.style.top = `${cy}px`;
                s.style.setProperty("--tx", `${(Math.random() - 0.5) * 260}px`);
                s.style.setProperty("--ty", `${-90 - Math.random() * 140}px`);
                s.style.setProperty(
                    "--rz",
                    `${(Math.random() - 0.5) * 220}deg`,
                );
                document.body.appendChild(s);
                setTimeout(() => s.remove(), 800);
            }
        }

        function burstLetters(anchor, text, max = 12) {
            const rect = anchor.getBoundingClientRect();
            const cx = rect.left + rect.width / 2;
            const cy = rect.top + rect.height / 2;

            // tomamos caracteres aleatorios del email
            const chars = text.split("").filter((c) => c.trim().length);
            for (let i = 0; i < Math.min(max, chars.length); i++) {
                const ch = chars[Math.floor(Math.random() * chars.length)];
                const s = document.createElement("span");
                s.className = "letter-spark";
                s.textContent = ch;
                s.style.left = `${cx}px`;
                s.style.top = `${cy}px`;
                const dist = 120 + Math.random() * 160;
                const ang = Math.random() * Math.PI * 2;
                const tx = Math.cos(ang) * dist;
                const ty = Math.sin(ang) * dist * -0.6; // más hacia arriba
                s.style.setProperty("--tx", `${tx}px`);
                s.style.setProperty("--ty", `${ty}px`);
                s.style.setProperty(
                    "--rz",
                    `${(Math.random() - 0.5) * 180}deg`,
                );
                document.body.appendChild(s);
                setTimeout(() => s.remove(), 900);
            }
        }
    });
</script>

<style>
    /* ESTO puede quedar scopeado */
    #emailLink.is-copied {
        transform: scale(1.02);
    }
    #emailLink.is-copied .pill-label.copied {
        animation: pop-in 220ms ease-out;
    }

    @keyframes pop-in {
        from {
            opacity: 0;
            transform: translateY(4px) scale(0.98);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1.02);
        }
    }
</style>

<style is:global>
    /* confetti y letras por encima de todo y fijos al viewport */
    .confetti,
    .letter-spark {
        position: fixed;
        z-index: 9999;
        pointer-events: none;
        will-change: transform, opacity;
        opacity: 0;
    }

    .confetti {
        border-radius: 9999px;
        animation: confetti-fly 700ms ease-out forwards;
    }

    @keyframes confetti-fly {
        0% {
            opacity: 0;
            transform: translate(0, 0) rotate(0);
        }
        10% {
            opacity: 1;
        }
        100% {
            opacity: 0;
            transform: translate(var(--tx), var(--ty)) rotate(var(--rz));
        }
    }

    /* letras del email volando */
    .letter-spark {
        font-size: 14px;
        line-height: 1;
        font-weight: 700;
        color: #c7b7ff; /* violeta suave */
        text-shadow: 0 0 8px rgba(199, 183, 255, 0.35);
        animation: letter-fly 850ms cubic-bezier(0.18, 0.67, 0.29, 1.1) forwards;
    }

    @keyframes letter-fly {
        0% {
            opacity: 0;
            transform: translate(0, 0) rotate(0) scale(0.9);
        }
        15% {
            opacity: 1;
        }
        100% {
            opacity: 0;
            transform: translate(var(--tx), var(--ty)) rotate(var(--rz))
                scale(1.1);
        }
    }

    /* respeta reduce motion */
    @media (prefers-reduced-motion: reduce) {
        .confetti,
        .letter-spark {
            display: none !important;
        }
    }
</style>
