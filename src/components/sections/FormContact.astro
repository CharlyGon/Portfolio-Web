<section
    class="card-spot rounded-2xl border border-white/10 bg-white/5 p-6 md:p-8"
>
    <header class="mb-6">
        <h3 class="text-2xl font-bold">Escribime</h3>
        <p class="text-neutral-300 mt-1">
            Â¿Charlamos sobre cÃ³mo puedo aportar a tu equipo? ðŸš€
        </p>
    </header>

    <!-- Acciones rÃ¡pidas -->
    <div class="flex flex-wrap gap-3 mb-6">
        <button
            type="button"
            data-confetti-copy
            data-copy-value="fernandez-gonza@hotmail.com"
            data-copied-label="Â¡Copiado!"
            data-confetti="both"
            class="rounded-xl px-4 py-2 bg-white/10 hover:bg-white/15 transition inline-flex items-center gap-2 relative select-none"
        >
            ðŸ“§ <span class="pill-label normal">Copiar email</span>
            <span class="pill-label copied hidden font-semibold">Â¡Copiado!</span
            >
        </button>

        <a
            href="https://www.linkedin.com/in/gonzalo-nicolas-fernandez"
            target="_blank"
            rel="noopener noreferrer"
            class="rounded-xl px-4 py-2 ring-1 ring-white/15 hover:bg-white/5 transition inline-flex items-center gap-2"
        >
            ðŸ’¼ <span>Escribirme por LinkedIn</span> â†—
        </a>
    </div>

    <!-- Formulario -->
    <form id="contactForm" class="grid gap-4" novalidate>
        <!-- Honeypot anti-spam -->
        <input
            type="text"
            name="_gotcha"
            class="hidden"
            tabindex="-1"
            autocomplete="off"
        />

        <div class="grid gap-2">
            <label for="name" class="text-sm opacity-80">Tu nombre</label>
            <input
                id="name"
                name="name"
                type="text"
                required
                class="w-full rounded-lg bg-black/30 border border-white/10 px-3 py-2"
                placeholder="CÃ³mo te llamÃ¡s"
            />
        </div>

        <div class="grid gap-2">
            <label for="email" class="text-sm opacity-80">Tu email</label>
            <input
                id="email"
                name="email"
                type="email"
                required
                class="w-full rounded-lg bg-black/30 border border-white/10 px-3 py-2"
                placeholder="nombre@empresa.com"
            />
        </div>

        <div class="grid gap-2">
            <label for="message" class="text-sm opacity-80">Mensaje</label>
            <textarea
                id="message"
                name="message"
                rows="6"
                required
                minlength="10"
                maxlength="500"
                class="w-full rounded-lg bg-black/30 border border-white/10 px-3 py-2 resize-y"
                placeholder="Contame brevemente quÃ© necesitÃ¡s"
                style="min-height: 150px; max-height: 300px;"></textarea>
        </div>

        <div class="flex items-center gap-3">
            <button
                id="submitBtn"
                type="submit"
                class="bg-white/10 hover:bg-white/15 disabled:bg-white/5 disabled:opacity-50 disabled:cursor-not-allowed rounded-full inline-flex items-center gap-2 px-5 py-2 transition"
            >
                Enviar mensaje
            </button>

            <span id="formStatus" class="text-sm opacity-80" aria-live="polite"
            ></span>
        </div>
    </form>
</section>

<script is:inline>
    const EMAIL = "fernandez-gonza@hotmail.com";
    const FORMSPREE_ENDPOINT = "https://formspree.io/f/mnqejnlz";

    const form = document.getElementById("contactForm");
    const statusEl = document.getElementById("formStatus");
    const submitBtn = document.getElementById("submitBtn");

    const emailInput = document.getElementById("email");
    const messageInput = document.getElementById("message");

    submitBtn.disabled = true;

    function validateForm() {
        const emailValid =
            emailInput.value.trim() !== "" && emailInput.checkValidity();
        const messageValid = messageInput.value.trim() !== "";
        submitBtn.disabled = !(emailValid && messageValid);
    }

    emailInput.addEventListener("input", validateForm);
    messageInput.addEventListener("input", validateForm);

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();
        statusEl.textContent = "";
        submitBtn.disabled = true;
        submitBtn.textContent = "Enviandoâ€¦";

        const formData = new FormData(form);
        formData.append("_subject", "Nuevo contacto desde el portfolio");
        formData.append("_data", JSON.stringify({ source: "portfolio-site" }));

        try {
            const res = await fetch(FORMSPREE_ENDPOINT, {
                method: "POST",
                headers: { Accept: "application/json" },
                body: formData,
            });

            if (res.ok) {
                form.reset();
                statusEl.textContent = "Â¡Gracias! Te respondo pronto.";

                setTimeout(() => {
                    statusEl.classList.add("fade-out");
                }, 4000);

                setTimeout(() => {
                    statusEl.textContent = "";
                    statusEl.classList.remove("fade-out");
                }, 5000);
            } else {
                statusEl.textContent =
                    "Hubo un problema al enviar. ProbÃ¡ mÃ¡s tarde o escribime por LinkedIn.";
            }
        } catch (err) {
            console.error(err);
            statusEl.textContent =
                "No se pudo enviar. RevisÃ¡ tu conexiÃ³n o usÃ¡ LinkedIn/Email.";
        } finally {
            validateForm();
            submitBtn.textContent = "Enviar mensaje";
        }
    });
</script>

<style>
    .fade-out {
        opacity: 0;
        transition: opacity 0.8s ease-out;
    }
</style>

<script type="module" src="/scripts/copy-confetti.js"></script>
