---
import aoe from "../../data/aoe-insights.json";
import books from "@/data/books.json";
---

<section
    class="card-spot rounded-2xl border border-white/10 bg-white/5 p-6 md:p-8"
    style="--spot-r: 140px; --spot-a: .08"
>
    <header class="mb-4">
        <h3 class="text-2xl font-bold">Mi enfoque</h3>
        <p class="text-neutral-300 mt-1">
            Backend Developer ‚Ä¢ Node.js & TypeScript
        </p>
    </header>

    <div class="grid gap-8 md:grid-cols-2">
        <!-- INTRO -->
        <div class="space-y-4">
            <p class="opacity-90">
                Soy <strong>Gonzalo Fern√°ndez</strong>, desarrollador backend
                con foco en
                <strong>Node.js</strong> y <strong>TypeScript</strong>. Vengo de
                un cambio de carrera y desde 2021 trabajo creando APIs,
                microservicios y automatizaciones orientadas a producci√≥n. Me
                mueven la mejora continua, la claridad en el c√≥digo y entregar
                valor de negocio de forma constante.
            </p>
            <p class="opacity-90">
                Disfruto construir soluciones <em>escalables y medibles</em>,
                documentar lo necesario y trabajar codo a codo con el equipo
                para que cada entrega sea un paso firme. Actualmente sigo
                profundizando en <strong>arquitectura de microservicios</strong
                >, <strong>Serverless</strong> y
                <strong>observabilidad</strong>.
            </p>
            <div class="flex flex-wrap gap-2 pt-1">
                <span
                    class="rounded-full px-3 py-1 text-xs bg-white/10 border border-white/10"
                    >Trabajo en equipo</span
                >
                <span
                    class="rounded-full px-3 py-1 text-xs bg-white/10 border border-white/10"
                    >Autodidacta</span
                >
                <span
                    class="rounded-full px-3 py-1 text-xs bg-white/10 border border-white/10"
                    >Comunicaci√≥n clara</span
                >
                <span
                    class="rounded-full px-3 py-1 text-xs bg-white/10 border border-white/10"
                    >Ownership</span
                >
            </div>
        </div>

        <!-- STACK / SKILLS -->
        <div class="space-y-4">
            <h4 class="font-semibold">Tecnolog√≠as con las que trabajo</h4>
            <ul class="flex flex-wrap gap-2 text-sm">
                <li
                    class="rounded-full px-3 py-1 bg-white/10 border border-white/10"
                >
                    Node.js
                </li>
                <li
                    class="rounded-full px-3 py-1 bg-white/10 border border-white/10"
                >
                    TypeScript
                </li>
                <li
                    class="rounded-full px-3 py-1 bg-white/10 border border-white/10"
                >
                    NestJS
                </li>
                <li
                    class="rounded-full px-3 py-1 bg-white/10 border border-white/10"
                >
                    Express
                </li>
                <li
                    class="rounded-full px-3 py-1 bg-white/10 border border-white/10"
                >
                    AWS (Lambda, S3, SQS)
                </li>
                <li
                    class="rounded-full px-3 py-1 bg-white/10 border border-white/10"
                >
                    Docker
                </li>
                <li
                    class="rounded-full px-3 py-1 bg-white/10 border border-white/10"
                >
                    SQL / MongoDB
                </li>
                <li
                    class="rounded-full px-3 py-1 bg-white/10 border border-white/10"
                >
                    CI/CD
                </li>
            </ul>

            <h4 class="font-semibold pt-2">C√≥mo suelo aportar</h4>
            <ul class="list-disc list-inside opacity-90 space-y-1 text-sm">
                <li>
                    Dise√±o de APIs y microservicios listos para producci√≥n
                    (logs, envs, tests).
                </li>
                <li>
                    Automatizaciones y jobs serverless para reducir tareas
                    repetitivas.
                </li>
                <li>
                    Buenas pr√°cticas: tipado estricto, revisi√≥n de PRs y
                    documentaci√≥n √∫til.
                </li>
            </ul>
        </div>
    </div>

    <footer class="mt-6 flex flex-wrap gap-3">
        <a
            href="/cv/CV_Gonzalo_Fernandez.pdf"
            target="_blank"
            rel="noopener"
            class="rounded-xl px-4 py-2 ring-1 ring-white/15 hover:bg-white/5 transition"
            >Descargar CV</a
        >
        <a
            href="#contact"
            class="rounded-xl px-4 py-2 bg-white/10 hover:bg-white/15 transition"
            >¬øCharlamos? üöÄ</a
        >
    </footer>
</section>

<section
    class="card-spot rounded-2xl border border-white/10 bg-white/5 p-6 md:p-8 mt-8"
    style="--spot-r: 140px; --spot-a: .08"
>
    <h4 class="text-xl md:text-2xl font-semibold mb-4">Fuera del c√≥digo</h4>

    <div class="space-y-4">
        <!-- HOBBY / AOE II ‚Äî Flip card -->
        <article
            class="flip-card rounded-xl border border-white/10 bg-black/30"
        >
            <div class="flip-inner">
                <!-- FRONT -->
                <div class="flip-face front p-4">
                    <img
                        src="/public/logo-clan.svg"
                        alt="Logo Clan"
                        class="absolute top-3 right-3 w-10 h-10 rounded-full ring-1 ring-white/10"
                    />
                    <div class="flex items-start gap-3">
                        <span
                            class="inline-flex w-9 h-9 items-center justify-center rounded-lg bg-white/10 ring-1 ring-white/10"
                            >üéÆ</span
                        >
                        <div class="min-w-0">
                            <div class="mb-5">
                                <span
                                    class="inline-flex items-center gap-1 text-[10px] px-2 py-0.5 rounded-full bg-white/10 ring-1 ring-white/10 tracking-wide"
                                    >HOBBY</span
                                >
                            </div>
                            <h5 class="font-semibold leading-tight">
                                Estrategia en tiempo real (AoE II)
                            </h5>
                            <p class="opacity-90 text-sm mt-1">
                                Fan de <strong>Age of Empires II</strong>. Me
                                entrena el pensamiento estrat√©gico:
                                <em>macro</em>, <em>timing</em> y <em
                                    >adaptabilidad</em
                                >‚Ä¶ lo llevo tal cual a producto y c√≥digo.
                            </p>
                            <ul class="mt-2 flex flex-wrap gap-2 text-[11px]">
                                <li
                                    class="rounded-full px-2 py-1 bg-white/10 border border-white/10"
                                >
                                    Planificaci√≥n
                                </li>
                                <li
                                    class="rounded-full px-2 py-1 bg-white/10 border border-white/10"
                                >
                                    Prioridades
                                </li>
                                <li
                                    class="rounded-full px-2 py-1 bg-white/10 border border-white/10"
                                >
                                    Ejecuci√≥n
                                </li>
                            </ul>

                            <button
                                type="button"
                                class="mt-3 rounded-full px-3 py-1.5 text-sm bg-white/10 hover:bg-white/15 ring-1 ring-white/10 transition flip-btn"
                            >
                                Ver estad√≠sticas ‚Üó
                            </button>
                        </div>
                    </div>
                </div>

                <!-- BACK (datos desde JSON) -->
                <div class="flip-face back p-4">
                    <header class="flex items-center justify-between">
                        <div>
                            <h6 class="font-semibold">
                                AoE II ‚Äî Highlights personales
                            </h6>
                            <p class="text-xs opacity-70">Datos ilustrativos</p>
                        </div>
                        <button
                            type="button"
                            class="rounded-full px-3 py-1.5 text-sm bg-white/10 hover:bg-white/15 ring-1 ring-white/10 transition flip-btn"
                        >
                            Volver
                        </button>
                    </header>

                    <div class="grid gap-3 mt-3 md:grid-cols-3">
                        <!-- Mejor civilizaci√≥n -->
                        <div
                            class="stat-card rounded-lg bg-white/5 ring-1 ring-white/10 p-3"
                        >
                            <span
                                class="label opacity-70 block text-[11px] uppercase tracking-wide"
                                >Mejor civilizaci√≥n</span
                            >
                            <div
                                class="flex items-baseline justify-between mt-0.5"
                            >
                                <strong class="name text-sm"
                                    >{aoe.bestCiv.name}</strong
                                >
                                <span class="big text-xl font-bold">
                                    {aoe.bestCiv.winRate}<span
                                        class="text-sm font-semibold opacity-80"
                                        >%</span
                                    >
                                </span>
                            </div>
                            <p class="sub text-xs opacity-75 mt-1">
                                {aoe.bestCiv.matches} partidas, {
                                    aoe.bestCiv.wins
                                } victorias
                            </p>
                        </div>

                        <!-- Mejor mapa -->
                        <div
                            class="stat-card rounded-lg bg-white/5 ring-1 ring-white/10 p-3"
                        >
                            <span
                                class="label opacity-70 block text-[11px] uppercase tracking-wide"
                                >Mejor mapa</span
                            >
                            <div
                                class="flex items-baseline justify-between mt-0.5"
                            >
                                <strong class="name text-sm"
                                    >{aoe.bestMap.name}</strong
                                >
                                <span class="big text-xl font-bold">
                                    {aoe.bestMap.winRate}<span
                                        class="text-sm font-semibold opacity-80"
                                        >%</span
                                    >
                                </span>
                            </div>
                            <p class="sub text-xs opacity-75 mt-1">
                                {aoe.bestMap.matches} partidas, {
                                    aoe.bestMap.wins
                                } victorias
                            </p>
                        </div>

                        <!-- Mejor posici√≥n -->
                        <div
                            class="stat-card rounded-lg bg-white/5 ring-1 ring-white/10 p-3"
                        >
                            <span
                                class="label opacity-70 block text-[11px] uppercase tracking-wide"
                                >Mejor posici√≥n</span
                            >
                            <div
                                class="flex items-baseline justify-between mt-0.5"
                            >
                                <strong class="name text-sm"
                                    >{aoe.bestPos.name}</strong
                                >
                                <span class="big text-xl font-bold">
                                    {aoe.bestPos.winRate}<span
                                        class="text-sm font-semibold opacity-80"
                                        >%</span
                                    >
                                </span>
                            </div>
                            <p class="sub text-xs opacity-75 mt-1">
                                {aoe.bestPos.matches} partidas, {
                                    aoe.bestPos.wins
                                } victorias
                            </p>
                        </div>
                    </div>

                    <p class="mt-3 text-sm opacity-90">
                        Ver detalle completo:
                        <a
                            href={aoe.profileUrl}
                            target="_blank"
                            rel="noopener"
                            class="underline">AOE2Insights ‚Üó</a
                        >
                    </p>
                </div>
            </div>
        </article>

        <!-- LIBROS / INTER√âS -->
        <article
            class="flip-card rounded-xl border border-white/10 bg-black/30"
        >
            <div class="flip-inner">
                <!-- FRONT -->
                <div class="flip-face front p-4">
                    <div class="flex items-start gap-3">
                        <span
                            class="inline-flex size-9 items-center justify-center rounded-lg bg-white/10 ring-1 ring-white/10"
                            >üìö
                        </span>
                        <div class="min-w-0">
                            <div class="mb-5">
                                <span
                                    class="inline-flex items-center gap-1 text-[10px] px-2 py-0.5 rounded-full bg-white/10 ring-1 ring-white/10 tracking-wide"
                                    >LEARNING</span
                                >
                            </div>
                            <h5 class="font-semibold leading-tight">
                                Lectura y crecimiento
                            </h5>
                            <p class="opacity-90 text-sm mt-1">
                                Para m√≠, leer libros t√©cnicos no es solo teor√≠a:
                                es la forma de capacitarnos de verdad en buenas
                                pr√°cticas, arquitectura y visi√≥n a largo plazo.
                                Cada p√°gina refuerza la mentalidad de mejora
                                continua que aplico en mis proyectos.
                            </p>
                            <button
                                type="button"
                                class="mt-3 rounded-full px-3 py-1.5 text-sm bg-white/10 hover:bg-white/15 ring-1 ring-white/10 transition flip-btn"
                            >
                                Ver libros le√≠dos ‚Üó
                            </button>
                        </div>
                    </div>
                </div>

                <!-- BACK -->
                <div class="flip-face back p-4">
                    <header class="flex items-center justify-between gap-2">
                        <h6 class="font-semibold">Libros le√≠dos</h6>
                        <button
                            type="button"
                            class="rounded-full px-3 py-1.5 text-sm bg-white/10 hover:bg-white/15 ring-1 ring-white/10 transition flip-btn"
                        >
                            Volver
                        </button>
                    </header>

                    <!-- Track del carrusel -->
                    <div
                        class="books-carousel mt-3 flex gap-3 overflow-x-auto snap-x snap-mandatory scroll-smooth pr-1 -mr-1 hide-scrollbar"
                    >
                        {
                            books.map((b) => (
                                <article
                                    class="
                                        book-item snap-start shrink-0
                                        min-w-[78%] sm:min-w-[60%] md:min-w-[48%] lg:min-w-[32%]
                                        rounded-lg border border-white/10 bg-white/[0.03] p-3
                                        hover:bg-white/[0.05] hover:-translate-y-[2px]
                                        transition transform duration-300"
                                >
                                    <h6 class="font-semibold">{b.title}</h6>
                                    <p class="text-xs opacity-70">
                                        {b.author}
                                        {b.year ? ` ‚Ä¢ ${b.year}` : ""}
                                    </p>
                                </article>
                            ))
                        }
                    </div>
                    <!-- Dots -->
                    <div
                        class="books-dots mt-3 flex items-center justify-center gap-2"
                    >
                    </div>
                    <!-- Flechas -->
                    <div class="mt-6 flex items-center justify-center gap-4">
                        <button
                            type="button"
                            class="books-prev rounded-full px-3 py-1.5 text-sm bg-white/10 hover:bg-white/15 ring-1 ring-white/10 transition"
                            aria-label="Anterior">‚Äπ</button
                        >

                        <button
                            type="button"
                            class="books-next rounded-full px-3 py-1.5 text-sm bg-white/10 hover:bg-white/15 ring-1 ring-white/10 transition"
                            aria-label="Siguiente">‚Ä∫</button
                        >
                    </div>
                </div>
            </div>
        </article>
    </div>
</section>

<script is:inline>
    // Spotlight
    document.addEventListener("astro:page-load", () => {
        document.querySelectorAll(".card-spot").forEach((card) => {
            card.addEventListener("mousemove", (e) => {
                const r = card.getBoundingClientRect();
                card.style.setProperty("--mx", `${e.clientX - r.left}px`);
                card.style.setProperty("--my", `${e.clientY - r.top}px`);
            });
        });
    });
</script>

<script is:inline>
    // Flip cards
    (function initFlip(selector = ".flip-card") {
        const cards = document.querySelectorAll(selector);
        cards.forEach((card) => {
            if (card.dataset.flipBound === "1") return;
            card.dataset.flipBound = "1";
            card.querySelectorAll(".flip-btn").forEach((btn) => {
                btn.addEventListener("click", (e) => {
                    e.preventDefault();
                    card.classList.toggle("is-flipped");
                });
            });
        });
        console.debug("[flip] bound", cards.length);
    })();

    document.addEventListener("astro:page-load", () => {
        console.debug("[flip] astro:page-load");
        (function initFlip(selector = ".flip-card") {
            const cards = document.querySelectorAll(selector);
            cards.forEach((card) => {
                if (card.dataset.flipBound === "1") return;
                card.dataset.flipBound = "1";
                card.querySelectorAll(".flip-btn").forEach((btn) => {
                    btn.addEventListener("click", (e) => {
                        e.preventDefault();
                        card.classList.toggle("is-flipped");
                    });
                });
            });
            console.debug("[flip] rebound", cards.length);
        })();
    });
</script>

{/*TODO: mover esta funci√≥n a otro archivo*/}
<script is:inline>
    // Altura para que no se corte el dorso
    function syncFlipHeight(card) {
        const inner = card.querySelector(".flip-inner");
        if (!inner) return;
        const front = card.querySelector(".flip-face.front");
        const back = card.querySelector(".flip-face.back");
        const h = Math.max(front?.scrollHeight || 0, back?.scrollHeight || 0);
        inner.style.height = h + "px";
    }

    // Carrusel
    function mountBooksCarousel(card) {
        const track = card.querySelector(".books-carousel");
        if (!track) return;

        const prev = card.querySelector(".books-prev");
        const next = card.querySelector(".books-next");
        const dotsC = card.querySelector(".books-dots");
        const items = [...track.querySelectorAll(".book-item")];
        if (items.length === 0) return;

        const measureStep = () => {
            const a = items[0].getBoundingClientRect();
            const b = items[1]?.getBoundingClientRect();
            let s = b ? b.left - a.left : a.width; // distancia entre cards
            if (!Number.isFinite(s) || s <= 0) s = a.width;
            return Math.max(1, Math.round(s));
        };
        let STEP = measureStep();

        // Dots
        dotsC.innerHTML = "";
        const dots = items.map((_, i) => {
            const d = document.createElement("button");
            d.type = "button";
            d.setAttribute("aria-label", `Ir al item ${i + 1}`);
            d.addEventListener("click", (e) => {
                e.preventDefault();
                track.scrollTo({ left: i * STEP, behavior: "smooth" });
            });
            dotsC.appendChild(d);
            return d;
        });

        function updateDots() {
            const idx = Math.round(track.scrollLeft / STEP);
            dots.forEach((d, i) =>
                d.setAttribute("aria-current", String(i === idx)),
            );
        }
        updateDots();

        // Flechas
        prev?.addEventListener("click", (e) => {
            e.preventDefault();
            track.scrollTo({
                left: Math.max(0, track.scrollLeft - STEP),
                behavior: "smooth",
            });
        });
        next?.addEventListener("click", (e) => {
            e.preventDefault();
            const max = track.scrollWidth - track.clientWidth;
            track.scrollTo({
                left: Math.min(max, track.scrollLeft + STEP),
                behavior: "smooth",
            });
        });

        // Eventos
        track.addEventListener("scroll", updateDots, { passive: true });
        window.addEventListener("resize", () => {
            STEP = measureStep();
            updateDots();
            syncFlipHeight(card);
        });

        syncFlipHeight(card);
    }

    function boot() {
        document.querySelectorAll(".flip-card").forEach((card) => {
            // si ya se binde√≥ el flip, no lo volvemos a hacer
            if (!card.dataset.flipBound) {
                card.dataset.flipBound = "1";
                card.querySelectorAll(".flip-btn").forEach((btn) => {
                    btn.addEventListener("click", (e) => {
                        e.preventDefault();
                        card.classList.toggle("is-flipped");
                        syncFlipHeight(card);
                    });
                });
            }

            mountBooksCarousel(card);
            syncFlipHeight(card);
        });
    }

    if (document.readyState !== "loading") boot();
    else document.addEventListener("DOMContentLoaded", boot);

    document.addEventListener("astro:page-load", boot);
</script>
